–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ
–†–∞–±–æ—Ç–∞ —Å NFS

–¶–µ–ª—å:
–Ω–∞—É—á–∏—Ç—å—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å NFS –∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –∫ –Ω–µ–º—É –∫–ª–∏–µ–Ω—Ç–æ–≤;


–û–ø–∏—Å–∞–Ω–∏–µ/–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è:
üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

–∑–∞–ø—É—Å—Ç–∏—Ç—å 2 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω—ã (—Å–µ—Ä–≤–µ—Ä NFS –∏ –∫–ª–∏–µ–Ω—Ç–∞);
–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ NFS –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è;
–≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏–º–µ–Ω–µ–º upload —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –Ω–µ—ë;
—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã (systemd, autofs –∏–ª–∏ fstab ‚Äî –ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º);
–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–±–æ—Ç–∞ NFS –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º NFSv3.

–†–µ—à–µ–Ω–∏–µ:
–ê–†–ú1 —Å —Å–µ—Ä–≤–µ—Ä–æ–º NFS –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∞–¥—Ä–µ—Å 172.21.76.22
–ê–†–ú2 —Å –∫–ª–∏–µ–Ω—Ç–æ–º NFS –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∞–¥—Ä–µ—Å 172.21.76.99

–£—Å—Ç–∞–Ω–æ–≤–∏–º NFS —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ê–†–ú1
sudo apt install nfs-kernel-server

–£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–æ—Ä—Ç—ã 2049 –∏ 111 –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è
ss - tnplu

–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
sudo mkdir -p /srv/share/upload
sudo chown -R nobody:nogroup /srv/share
sudo chmod 0777 /srv/share/upload

–°–æ–∑–¥–∞–µ–º –≤ —Ñ–∞–π–ª–µ /etc/exports —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
cat << EOF > /etc/exports/srv/share 172.21.76.99/32(rw,sync,root_squash)
EOF

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
exportfs -r

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ê–†–ú2 –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–ª–∏–µ–Ω—Ç NFS
sudo apt install nfs-common

–î–æ–±–∞–≤–ª—è–µ–º –≤ fstab —Å—Ç—Ä–æ—á–∫—É
echo "192.168.50.10:/srv/share/ /mnt nfs vers=3,noauto,x-systemd.automount 0 0" >> /etc/fstab

–í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã 
systemctl daemon-reload
systemctl restart remote-fs.target

—Å–æ–∑–¥–∞–µ–º –Ω–∞ –ê–†–ú1 (—Å–µ—Ä–≤–µ—Ä NFS) —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª check_file –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ê–†–ú2 –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ê–†–ú2 –¥—Ä—É–≥–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª client_file –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–Ω –ø–æ—è–≤–∏–ª—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ê–†–ú1

–ê–†–ú1:touch /srv/share/upload check_file
–ê–†–ú2:ll /mnt/upload/
–ê–†–ú2:touch /mnt/upload client_file
–ê–†–ú1:ll /srv/share/upload


–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —É–¥–∞–ª–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏ –∏ —Å–æ–∑–¥–∞–µ–º –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –ê–†–ú2 —Ñ–∞–π–ª final_check

–ê–†–ú2: touch /mnt/upload/final_check
